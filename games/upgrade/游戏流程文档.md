# 升级游戏流程文档

## 1. 游戏简介

升级是一种四人扑克牌游戏，使用两副牌（共108张牌），玩家分为两队对战。游戏目标是通过合理的出牌策略，使自己队伍的得分超过对方。

## 2. 游戏流程概述

升级游戏的主要流程包括以下几个阶段：

1. 玩家登录和准备阶段
2. 发牌阶段
3. 定主阶段
4. 庄家扣底阶段
5. 反底阶段（可选）
6. 出牌阶段
7. 计分和升级阶段
8. 循环至下一局

## 3. 详细游戏流程

### 3.1 登录和准备阶段

1. 玩家启动客户端，进入登录界面
2. 输入用户名、性别、服务器地址和座位号
3. 客户端连接到服务器
4. 当四个玩家都准备就绪后，游戏自动开始

### 3.2 发牌阶段

1. 服务器洗牌并给每位玩家发25张牌
2. 剩余8张牌作为底牌

### 3.3 定主阶段

1. 玩家可以选择亮主来确定主牌花色
2. 亮主方式：
   - 单张级牌（如级牌为5，则可以亮单张5）
   - 一对级牌或一对王
3. 亮主规则：
   - 级牌可以单张亮主
   - 王不能单张亮主
   - 两王可以亮主
   - 大王比小王大，同色对牌比不同色对牌大
4. 如果所有玩家都选择PASS，则系统随机翻开一张底牌作为主牌花色

### 3.4 庄家扣底阶段

1. 确定庄家后，庄家获得8张底牌
2. 庄家需要从手中的33张牌中选择8张作为新的底牌
3. 庄家扣完底牌后，手中剩余25张牌

### 3.5 反底阶段（可选）

1. 在庄家扣底后，其他玩家可以进行反底操作
2. 反底方式：
   - 亮出一对更大的牌（如原底牌为一对A，可以反一对更大的A或其他牌）
   - 亮出王（小王或大王）
3. 反底规则：
   - 必须按顺序进行
   - 反底的牌必须比当前主牌更大
   - 反底成功后，该玩家成为新庄家并获得底牌
4. 如果所有玩家都选择PASS，则进入出牌阶段

### 3.6 出牌阶段

1. 由庄家先出牌
2. 出牌规则：
   - 第一家可以出任意牌型（单张、对子、拖拉机等）
   - 其他玩家必须跟相同数量的牌
   - 必须跟相同花色的牌（如果手中有该花色）
   - 必须跟相同类型的牌型（如果手中有足够的该类型牌）
3. 甩牌规则：
   - 第一家可以甩牌（出不连续的牌型）
   - 如果其他玩家有更大的牌，则甩牌失败，必须出最大的牌
4. 一轮结束后，最大的玩家获得该轮所有牌并获得下一轮出牌权

### 3.7 计分和升级阶段

1. 计分规则：
   - 5牌计5分
   - 10牌和K牌计10分
   - 其他牌不计分
2. 扣底规则：
   - 如果庄家方获胜，底牌分数乘以相应倍数
   - 倍数根据最后出牌牌型决定（单张1倍，对子2倍，拖拉机4倍等）
3. 升级规则：
   - 如果庄家方得分小于80分，庄家方升3级
   - 如果庄家方得分为80-119分，庄家方升2级
   - 如果庄家方得分为120-159分，庄家方升1级
   - 如果庄家方得分大于等于160分，庄家方下庄，由其对家坐庄
4. 确定下一局庄家：
   - 庄家方获胜则继续坐庄
   - 庄家方失败则按顺序轮换庄家

## 4. 游戏术语解释

- **级牌**：当前游戏的级别牌，如当前级别为5，则5为级牌
- **主牌**：确定的主花色牌和大小王
- **副牌**：除主牌外的其他花色牌
- **拖拉机**：连续的对子或更多张相同牌型
- **扣底**：庄家将手中的牌替换底牌的过程
- **反底**：其他玩家在庄家扣底后，通过亮主来抢夺庄家身份的过程

## 5. 特殊规则

1. 如果没有玩家亮主，则系统随机翻开一张底牌确定主花色
2. 如果庄家没有亮主，则其他玩家不能反底
3. 甩牌失败时，系统会强制玩家出最大的牌
4. 游戏中可以发送礼物和聊天信息

## 6. 技术实现要点

### 6.1 客户端

- 使用SOUI界面框架
- 通过WebSocket与服务器通信
- 实现了丰富的动画效果（发牌、出牌等）
- 支持音效和背景音乐

### 6.2 服务器端

- 管理游戏状态和玩家连接
- 处理游戏逻辑（发牌、定主、出牌等）
- 计算得分和确定升级级别
- 转发玩家间的消息（聊天、礼物等）